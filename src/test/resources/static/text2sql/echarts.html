<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>AI生成式图表</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
	<style>
		body {
			padding-top: 40px;
			background-color: #eee;
		}
		#submit {
			width: 200px;
		}
		#echarts {
			padding-top: 50px;
			height: 400px;
		}
	</style>
	<script>
		$(function () {
			var input = $('input[name="query"]');
			var submit = $('#submit');
			submit.on('click', function (e) {
				$.post('echarts', {'query': input.val()}, function(data) {
					try {
						$(data.series).each(function(index, item) {
							item.label = {
								'show': true,
								'position': 'top'
							};
						});
						var chart = echarts.init(document.getElementById('echarts'));
						chart.setOption(data);
					} catch(e) {
						console.log(e);
						alert('此问题不适合生成图表展示，请换一种问法。');
					}
					input.removeAttr('readonly');
					submit.removeAttr('disabled').html('查询');
				});
				input.attr('readonly', 'readonly');
				submit.attr('disabled', 'disabled').html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>正在查询...');
				return false;
			});
			input.keypress(function(event) {
				if (event.which === 13) {
					input.blur();
					submit.click();
					event.preventDefault();
				}
			});
		});
	</script>
</head>

<body>
<div class="container">
	<div class="input-group">
		<input type="text" name="query" class="form-control rounded" placeholder="请输入你的问题，比如：每个班级的平均分是多少？"/>
		<button type="button" id="submit" class="btn btn-primary">查询</button>
	</div>
	<div id="echarts"></div>
</div>
</body>

</html>
